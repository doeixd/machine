{
  "id": "auth",
  "initial": "LoggedOutMachine",
  "states": {
    "LoggedOutMachine": {
      "on": {
        "login": {
          "target": "LoggingInMachine",
          "description": "Start the login process with username and password",
          "actions": [
            "logLoginAttempt"
          ]
        }
      }
    },
    "LoggingInMachine": {
      "on": {
        "cancel": {
          "target": "LoggedOutMachine",
          "description": "Cancel the login process and return to logged out state",
          "actions": [
            "logLoginCanceled"
          ]
        }
      },
      "invoke": [
        {
          "src": "authenticateUser",
          "onDone": {
            "target": "LoggedInMachine"
          },
          "onError": {
            "target": "ErrorMachine"
          },
          "description": "Call authentication API and retrieve user session token"
        }
      ]
    },
    "LoggedInMachine": {
      "on": {
        "logout": {
          "target": "LoggedOutMachine",
          "description": "Log out the current user and clear session data",
          "actions": [
            "clearSessionData"
          ]
        },
        "deleteAccount": {
          "target": "LoggedOutMachine",
          "description": "Delete the user account (admin only)",
          "cond": "hasAdminPermission",
          "actions": [
            "logAccountDeletion"
          ]
        },
        "onSessionExpired": {
          "target": "SessionExpiredMachine",
          "description": "Handle session expiration timeout"
        }
      },
      "invoke": [
        {
          "src": "refreshAuthToken",
          "onDone": {
            "target": "LoggedInMachine"
          },
          "onError": {
            "target": "SessionExpiredMachine"
          },
          "description": "Call token refresh endpoint with current token"
        }
      ]
    },
    "SessionExpiredMachine": {
      "on": {
        "reAuthenticate": {
          "target": "LoggingInMachine",
          "description": "Re-authenticate the user after session expiration"
        },
        "logout": {
          "target": "LoggedOutMachine",
          "description": "Log out after session expiration"
        }
      }
    },
    "ErrorMachine": {
      "on": {
        "retry": {
          "target": "LoggingInMachine",
          "description": "Retry the failed authentication or session operation"
        },
        "dismiss": {
          "target": "LoggedOutMachine",
          "description": "Dismiss the error and return to logged out state"
        }
      }
    }
  },
  "description": "User authentication state machine with login, session management, and error handling"
}